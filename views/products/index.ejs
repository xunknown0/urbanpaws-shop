<% layout('layouts/boilerplate') -%>

<div class="container mt-5">
  <h1 class="mb-4 text-center">All Products</h1>

  <div class="row row-cols-1 row-cols-md-3 g-4">
    <% products.forEach(product => { %>
      <div class="col">
        <div class="card h-100 shadow-sm">

          <!-- Carousel Container -->
          <% if (product.images && product.images.length > 0) { %>
            <div id="carousel-<%= product._id %>" class="carousel slide" data-bs-ride="carousel">
              <div class="carousel-inner">
                <% product.images.forEach((img, index) => { %>
                  <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
                    <img src="<%= img.url %>" class="d-block w-100" style="object-fit: cover; height: 200px;" alt="<%= product.title %>">
                  </div>
                <% }) %>
              </div>
              <% if (product.images.length > 1) { %>
                <button class="carousel-control-prev" type="button" data-bs-target="#carousel-<%= product._id %>" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon"></span>
                  <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carousel-<%= product._id %>" data-bs-slide="next">
                  <span class="carousel-control-next-icon"></span>
                  <span class="visually-hidden">Next</span>
                </button>
              <% } %>
            </div>
          <% } else { %>
            <img src="/images/placeholder.png" class="card-img-top" style="height: 200px; object-fit: cover;" alt="No image available">
          <% } %>

          <!-- Card Body -->
          <div class="card-body">
            <h5 class="card-title"><%= product.title %></h5>
            <p class="card-text text-success fw-semibold">$<%= product.price.toFixed(2) %></p>
          </div>

          <!-- Card Footer -->
          <div class="card-footer bg-transparent border-top-0">
            <a href="/products/<%= product._id %>" class="btn btn-primary w-100">View Product</a>
          </div>
        </div>
      </div>
    <% }) %>
  </div>
</div>

<!-- Bootstrap CSS & JS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
