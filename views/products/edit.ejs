<% layout('layouts/boilerplate') -%>

<div class="container mt-5">
  <h1 class="mb-4 text-center">Edit Product</h1>

  <form action="/products/<%= product._id %>?_method=PUT" method="POST" id="productEditForm" enctype="multipart/form-data">
    
    <!-- Title -->
    <div class="mb-3">
      <label for="title" class="form-label">Title</label>
      <input
        type="text"
        id="title"
        name="product[title]"
        class="form-control"
        placeholder="Title"
        value="<%= product.title %>"
        required
      />
    </div>

    <!-- Price -->
    <div class="mb-3">
      <label for="price" class="form-label">Price</label>
      <input
        type="number"
        id="price"
        step="0.01"
        name="product[price]"
        class="form-control"
        placeholder="Price"
        value="<%= product.price %>"
        required
      />
    </div>

    <!-- Description -->
    <div class="mb-3">
      <label for="description" class="form-label">Description</label>
      <textarea
        id="description"
        name="product[description]"
        class="form-control"
        rows="4"
        placeholder="Description"
        required
      ><%= product.description %></textarea>
    </div>

    <!-- Location -->
    <div class="mb-3">
      <label for="location" class="form-label">Location</label>
      <input
        type="text"
        id="location"
        name="product[location]"
        class="form-control"
        placeholder="Location"
        value="<%= product.location %>"
        required
      />
    </div>

    <!-- Image Upload -->
    <div class="mb-3">
      <label for="imageUpload" class="form-label">Upload Images</label>
      <input type="file" id="imageUpload" accept="image/*" name="images" class="form-control" multiple />
    </div>

    <!-- Existing Images with Delete Option -->
    <div class="mb-3">
      <% if (product.images && product.images.length > 0) { %>
        <label class="form-label">Existing Images</label>
        <div class="d-flex flex-wrap">
          <% product.images.forEach((image, i) => { %>
            <div class="me-3 mb-3 text-center">
              <img src="<%= image.url %>" class="img-thumbnail" style="width:100px; height:100px; object-fit:cover;" alt="">
              <div class="form-check mt-1">
                <input type="checkbox" name="deleteImages[]" class="form-check-input" id="image<%= i %>" value="<%= image.public_id %>">
                <label class="form-check-label" for="image<%= i %>">Delete?</label>
              </div>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>

    <button type="submit" class="btn btn-primary w-100">Update Product</button>
  </form>
</div>

<!-- Optional: Product Edit JS -->
<script src="/javascripts/product-edit.js"></script>
